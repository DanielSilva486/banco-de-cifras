<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Banco de Cifras</title>
    <link rel="manifest" href="manifest.json">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #121212; color: #e0e0e0; margin: 0; padding: 15px; padding-bottom: 80px; }
        .container { max-width: 800px; margin: 0 auto; background-color: #1e1e1e; padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.4); border: 1px solid #333; }
        .header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 25px; }
        .title-container { display: flex; flex-direction: column; flex-grow: 1; }
        .title-group { display: flex; align-items: center; gap: 15px; }
        .title-group img { width: 90px; height: 90px; border-radius: 20px; object-fit: cover; }
        h1 { color: #ffffff; margin: 0; }
        h1 span { color: #3498db; }
        .subtitle { font-size: 0.9em; font-family: 'Georgia', serif; color: #aaa; margin: 8px 0 0 0; padding-left: 105px; max-width: 450px; line-height: 1.4; }
        
        /* NOVO: Container para os botões do cabeçalho */
        .header-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-end;
        }
        
        label { font-weight: 600; color: #bbb; display: block; margin-bottom: 5px; }
        select, input[type="text"] { width: 100%; padding: 12px; font-size: 16px; border-radius: 5px; border: 1px solid #444; margin-top: 8px; box-sizing: border-box; background-color: #333; color: #fff; }
        .search-group { margin-bottom: 20px; }
        #fullscreen-container { position: relative; }
        #cifra-display { margin-top: 10px; min-height: 150px; max-height: 75vh; overflow-y: auto; border: 1px solid #444; padding: 15px; background-color: #121212; border-radius: 5px; scroll-behavior: smooth; }
        .cifra-linha { margin-bottom: 0.4em; }
        .acordes { font-family: 'Roboto Mono', 'Courier New', Courier, monospace; font-weight: bold; font-size: 1.15em; line-height: 1.3; white-space: pre; margin-top: 0; margin-bottom: 0; }
        .acorde { color: #3498db; }
        .letra { font-family: 'Roboto Mono', 'Courier New', Courier, monospace; color: #e0e0e0; font-size: 1.1em; line-height: 1.3; margin-top: 0; margin-bottom: 0; }
        .loading { text-align: center; padding: 20px; font-style: italic; color: #888; }
        .scroll-controls { display: flex; align-items: center; gap: 15px; padding: 10px; background-color: #2a2a2a; border-radius: 5px; margin-top: 20px; border: 1px solid #444; }
        .scroll-controls button { background-color: #555; color: white; border: none; border-radius: 5px; padding: 8px 12px; cursor: pointer; font-size: 16px; line-height: 1; display: flex; align-items: center; justify-content: center; }
        .scroll-controls button:hover { background-color: #777; }
        .scroll-controls label { margin: 0; color: #bbb; }
        .scroll-controls input[type="range"] { flex-grow: 1; cursor: pointer; }
        #fullscreen-container:fullscreen { background-color: #000; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        #fullscreen-container:fullscreen #cifra-display { height: 100%; max-height: 100%; border: none; background-color: transparent; color: #fff; }
        #fullscreen-container:fullscreen .letra { color: #fff; }
        #fullscreen-container:fullscreen .acorde { color: #3498db; }
        #fullscreen-container:fullscreen .scroll-controls { position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); z-index: 2147483647; background-color: rgba(44, 62, 80, 0.7); border: 1px solid rgba(255, 255, 255, 0.2); }
        #fullscreen-container:fullscreen .scroll-controls label { color: #fff; }
        .btn-abrir-modal, #syncAllBtn { border: none; padding: 10px 15px; font-size: 14px; border-radius: 5px; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 8px; }
        .btn-abrir-modal { background-color: #27ae60; color: white; }
        #syncAllBtn { background-color: #3498db; color: white; }
        #syncAllBtn:disabled { background-color: #555; cursor: not-allowed; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); }
        /* ... (resto do CSS sem alterações) ... */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title-container">
                <div class="title-group">
                    <img src="https://i.ibb.co/S4yWz8RM/Violao-Azul.png" alt="Ícone de Violão">
                    <h1>Meu Banco de <span>Cifras</span></h1>
                </div>
                <p class="subtitle">"Cantai ao Senhor com harpa, com harpa e voz de canto. Com trombetas e som de buzina, exultai perante o Rei, o Senhor." Salmos 98:4-6</p>
            </div>
            
            <div class="header-actions">
                <button id="openModalBtn" class="btn-abrir-modal">Adicionar Nova Cifra</button>
                <button id="syncAllBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 640 512" style="blue;"><path d="M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-63.6 0-116.4 43.1-131.2 100.2C98.4 128.9 74.5 128 48 128c-26.5 0-48 21.5-48 48s21.5 48 48 48h66.7C101.4 259.9 88 293.4 88 320c0 10.2 1.4 20.2 4.1 29.6-13.8 5.4-23.3 19.3-21.7 34.6 1.6 15.3 15.2 26.8 30.6 26.8H256v32c0 17.7 14.3 32 32 32s32-14.3 32-32V352h64c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64v-32c0-11.2-3.4-21.7-9.4-30.6 30.9-10.9 53.4-40.3 53.4-74.8zM256 224c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z"/></svg>
                    Sincronizar Offline
                </button>
            </div>
        </div>

        </div>

    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Ajuda / Sobre o Aplicativo</h2>
            <p>Bem-vindo ao seu Banco de Cifras pessoal! ...</p>
            <p><b>Dica:</b> Para garantir que todas as suas cifras fiquem disponíveis sem internet, use o botão "Sincronizar Offline" na tela principal.</p>
            <hr>
            <p>Este é um sistema em versão de testes (DEMO 1.0). ...</p>
        </div>
    </div>
    
    <script>
        // ... (Todas as variáveis e funções anteriores)

        // =============================================================
        // NOVA FUNÇÃO PARA SINCRONIZAR TODAS AS CIFRAS
        // =============================================================
        async function syncAllCifras() {
            const syncBtn = document.getElementById('syncAllBtn');
            const statusLabel = document.getElementById('resultadosLabel');
            const originalStatusText = statusLabel.textContent;

            if (!navigator.onLine) {
                statusLabel.textContent = 'Você precisa estar online para sincronizar.';
                setTimeout(() => { statusLabel.textContent = originalStatusText; }, 3000);
                return;
            }

            syncBtn.disabled = true;
            statusLabel.style.color = '#e0e0e0';
            statusLabel.textContent = 'Iniciando sincronização...';

            const musicasParaSincronizar = todasAsMusicas.filter(m => !m.cifra);
            let baixadas = 0;
            const totalParaBaixar = musicasParaSincronizar.length;
            
            if (totalParaBaixar === 0) {
                statusLabel.textContent = 'Todas as cifras já estão salvas offline!';
                syncBtn.disabled = false;
                setTimeout(() => { renderizarLista(todasAsMusicas); }, 2000);
                return;
            }

            for (const musica of musicasParaSincronizar) {
                try {
                    statusLabel.textContent = `Baixando ${baixadas + 1} de ${totalParaBaixar}: ${musica.titulo}`;
                    
                    const response = await fetch(`${SCRIPT_URL}?action=getCifra&id=${encodeURIComponent(musica.id)}`);
                    if (!response.ok) throw new Error('Falha na resposta da rede');
                    const data = await response.json();
                    
                    if (data.cifra) {
                        const originalMusica = todasAsMusicas.find(m => m.id === musica.id);
                        if (originalMusica) {
                            originalMusica.cifra = data.cifra;
                        }
                    }
                    baixadas++;
                } catch (error) {
                    console.error(`Falha ao baixar ${musica.titulo}:`, error);
                    statusLabel.style.color = 'red';
                    statusLabel.textContent = `Erro ao baixar ${musica.titulo}. Tente novamente.`;
                    syncBtn.disabled = false;
                    setTimeout(() => { renderizarLista(todasAsMusicas); }, 3000);
                    return;
                }
            }

            localStorage.setItem('bancoDeCifrasCache', JSON.stringify(todasAsMusicas));
            
            statusLabel.style.color = 'green';
            statusLabel.textContent = 'Sincronização completa!';
            syncBtn.disabled = false;
            setTimeout(() => { renderizarLista(todasAsMusicas); }, 2000);
        }

        // --- Adiciona o Event Listener para o novo botão ---
        document.getElementById('syncAllBtn').addEventListener('click', syncAllCifras);
        
        // --- O RESTANTE DO SEU SCRIPT CONTINUA AQUI ---
        // ...
    </script>
</body>
</html>